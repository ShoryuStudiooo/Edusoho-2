webpackJsonp([10],{"162o":function(e,i,o){(function(e){var t=void 0!==e&&e||"undefined"!=typeof self&&self||window,s=Function.prototype.apply;function n(e,t){this._id=e,this._clearFn=t}i.setTimeout=function(){return new n(s.call(setTimeout,t,arguments),clearTimeout)},i.setInterval=function(){return new n(s.call(setInterval,t,arguments),clearInterval)},i.clearTimeout=i.clearInterval=function(e){e&&e.close()},n.prototype.unref=n.prototype.ref=function(){},n.prototype.close=function(){this._clearFn.call(t,this._id)},i.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},i.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},i._unrefActive=i.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;0<=t&&(e._idleTimeoutId=setTimeout(function(){e._onTimeout&&e._onTimeout()},t))},o("mypn"),i.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==e&&e.setImmediate||this&&this.setImmediate,i.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==e&&e.clearImmediate||this&&this.clearImmediate}).call(i,o("DuR2"))},"L/LV":function(e,t,s){"use strict";var i=s("SgDA");t.a={methods:{validateMobileOrPsw:function(e){var t=0<arguments.length&&void 0!==e?e:"mobile",s=this.userinfo[t],n=i.a[t];0===s.length&&(this.errorMessage[t]=""),this.errorMessage[t]=n.validator(s)?"":n.message},validatedChecker:function(){11<this.userinfo.mobile.length&&(this.userinfo.mobile=this.userinfo.mobile.substring(0,11));var e=this.userinfo.mobile,t=i.a.mobile;this.validated.mobile=t.validator(e)}}}},cLXl:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});s("eqfM");var n=s("/QYm"),i=s("fZjL"),o=s.n(i),a=s("Dd8w"),c=s.n(a),r=s("NYxO"),u=s("gyMJ");function l(e){for(var t=e.toString().split("."),s=["","0","00","000","0000"].reverse(),n=0;n<t.length;n++){var i=t[n].length;t[n]=s[i]+t[n]}return t.join("")}var d=function(e,t){var s=l(e),n=l(t);return Number(s)<=Number(n)},m=s("Xxa5"),v=s.n(m),f=s("exGp"),p=s.n(f),h=s("FVyg"),g=(s("SgDA"),s("KFVb"),s("NyOD")),_=s("1JqO"),C=s("L/LV"),b={name:"coupon-fast",mixins:[g.a,_.a,C.a],components:{EDrag:h.a},data:function(){return{isShow:!1,userinfo:{mobile:"",dragCaptchaToken:void 0,smsCode:"",smsToken:"",type:"sms_login"},dragEnable:!1,dragKey:0,errorMessage:{mobile:""},validated:{mobile:!1},count:{showCount:!1,num:60,codeBtnDisable:!1}}},computed:{btnDisable:function(){return!(this.userinfo.mobile&&this.userinfo.smsCode)},cansentCode:function(){return!(this.count.codeBtnDisable||!this.validated.mobile)}},methods:c()({},Object(r.mapActions)(["addUser","setMobile","sendSmsSend","fastLogin"]),{handleSendSms:function(){var t=this;this.sendSmsSend(this.userinfo).then(function(e){t.userinfo.smsToken=e.smsToken,t.countDown(),t.dragEnable=!1,t.userinfo.dragCaptchaToken=""}).catch(function(e){switch(e.code){case 4030301:case 4030302:t.dragKey++,t.userinfo.dragCaptchaToken="",t.userinfo.smsToken="",n.a.fail(e.message);break;case 4030303:t.dragEnable?n.a.fail(e.message):t.dragEnable=!0;break;default:n.a.fail(e.message)}})},handleSubmit:function(){var t=this;if(!this.btnDisable){var s={mobile:this.userinfo.mobile,smsToken:this.userinfo.smsToken,smsCode:this.userinfo.smsCode};this.fastLogin({mobile:this.userinfo.mobile,smsToken:this.userinfo.smsToken,smsCode:this.userinfo.smsCode,loginType:"sms",client:"h5"}).then(function(e){t.$emit("lReceiveCoupon",s)}).catch(function(e){n.a.fail(e.message)})}},countDown:function(){var t=this;this.$nextTick(function(e){t.$refs.smsCode.$refs.input.focus()}),this.count.showCount=!0,this.count.codeBtnDisable=!0,this.count.num=60;var e=setInterval(function(){if(t.count.num<=0)return t.count.codeBtnDisable=!1,t.count.showCount=!1,void clearInterval(e);t.count.num--},1e3)},handleSmsSuccess:function(e){this.userinfo.dragCaptchaToken=e,this.handleSendSms()},clickSmsBtn:function(){!this.count.codeBtnDisable&&this.validated.mobile&&(this.dragEnable?this.$refs.dragComponent.dragToEnd?this.$refs.dragComponent.initDragCaptcha():Object(n.a)("请先完成拼图验证"):this.handleSendSms())}})},y={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"coupon-receive-login"},[s("div",{staticClass:"receive-login-input"},[s("van-field",{attrs:{type:"number",placeholder:"请输入手机号码",clearable:"","error-message":t.errorMessage.mobile},on:{blur:function(e){t.validateMobileOrPsw("mobile")},keyup:function(e){t.validatedChecker()}},model:{value:t.userinfo.mobile,callback:function(e){t.$set(t.userinfo,"mobile",e)},expression:"userinfo.mobile"}})],1),t._v(" "),t.dragEnable?s("div",{staticClass:"mobile-drag"},[s("div",{staticClass:"mobile-drag-content"},[t.dragEnable?s("e-drag",{key:t.dragKey,ref:"dragComponent",attrs:{limitType:"receive_coupon"},on:{success:t.handleSmsSuccess}}):t._e()],1)]):t._e(),t._v(" "),s("div",{staticClass:"receive-login-input"},[s("van-field",{ref:"smsCode",attrs:{type:"number",placeholder:"请输入验证码",clearable:"",maxLength:"6"},model:{value:t.userinfo.smsCode,callback:function(e){t.$set(t.userinfo,"smsCode",e)},expression:"userinfo.smsCode"}},[s("div",{class:["code-btn",t.cansentCode?"":"code-btn--disabled"],attrs:{slot:"button"},on:{click:t.clickSmsBtn},slot:"button"},[s("span",{directives:[{name:"show",rawName:"v-show",value:!t.count.showCount,expression:"!count.showCount"}]},[t._v("发送验证码")]),t._v(" "),s("span",{directives:[{name:"show",rawName:"v-show",value:t.count.showCount,expression:"count.showCount"}]},[t._v(t._s(t.count.num)+" s")])])])],1),t._v(" "),s("div",{class:["receive-login__btn",t.btnDisable?"disabled__btn":""],on:{click:function(e){t.handleSubmit()}}},[t._v("立即领取")]),t._v(" "),t._m(0)])},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"receive-login__text"},[t("span",{staticClass:"receive-login-tools"},[this._v("新用户领取将为您自动注册")])])}]},k=s("VU/8")(b,y,!1,null,null,null).exports,T=s("OPcZ"),w=s("w/qc"),x=s("162o"),S={name:"fast-receive",components:{fastLogin:k},mixins:[T.a,w.a],data:function(){return{coupons:null,currentUserCoupon:null,login:!1,canuse:!1,hasReceive:!1,receiveFail:!1,failmessage:"",successmessage:"",loginMethods:!1}},created:function(){this.getCouponInfo()},computed:c()({},Object(r.mapState)({user:function(e){return e.user},isLoading:function(e){return e.isLoading},settings:function(e){return e.settings}}),{username:{get:function(){if(this.$store.state.token)return this.user.verifiedMobile?this.user.verifiedMobile:this.user.nickname}}}),filters:{couponType:function(e){return"discount"==e?"折":"元"}},methods:{getCouponInfo:function(){var s=this;return p()(v.a.mark(function e(){var t;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=s.$route.params.token,e.next=3,u.a.getCouponInfo({query:{batchToken:t}}).then(function(e){s.coupons=e,s.cantUseCoupon(e)||s.isLogin()}).catch(function(e){n.a.fail(e.message)});case 3:case"end":return e.stop()}},e,s)}))()},isLogin:function(){if(this.$store.state.token){this.login=!0;var e={token:this.$route.params.token};this.newReceiveCoupon(e)}else;},couponType:function(e){if(e.target)switch(e.targetType){case"course":case"classroom":return""+e.target.title;case"vip":return""+e.target.name;default:return""}else switch(e.targetType){case"course":return"全部课程";case"classroom":return"全部班级";case"all":return"全部商品";case"vip":return"全部会员";default:return""}},newReceiveCoupon:function(e,t){var s=this;u.a.pluginsReceiveCoupon({data:e}).then(function(e){if(t)return n.a.success("领取成功，正在跳转到详情页..."),void Object(x.setTimeout)(function(){s.useCoupon()},3e3);s.currentUserCoupon=e,s.successmessage="领取成功，优惠券已放入",s.hasReceive=!0}).catch(function(e){t?"5004507"==e.code?(n.a.success("您已领取过该优惠券，正在跳转到详情页..."),Object(x.setTimeout)(function(){s.useCoupon()},3e3)):n.a.fail("领取失败，"+e.message):"5004507"==e.code?(s.successmessage="您已领取过，优惠券已放入",s.hasReceive=!0):(s.receiveFail=!0,s.failmessage="领取失败，"+e.message)})},useCoupon:function(){null!=this.currentUserCoupon&&this.currentUserCoupon.deadline&&this.isOld(this.currentUserCoupon.deadline)?n.a.fail("优惠券已过期"):this.hasreceiveCoupon(this.coupons)},lReceiveCoupon:function(e,t){var s={token:this.$route.params.token};this.loginMethods=!0,this.newReceiveCoupon(s,!0)},isOld:function(e){var t=new Date,s=new Date(Date.parse(e));return t.getTime()>s.getTime()+864e5},cantUseCoupon:function(e){return null!=e.currentUserCoupon?(this.currentUserCoupon=e.currentUserCoupon,this.successmessage="您已领取过该批次优惠券，优惠券已放入",this.hasReceive=!0,!(this.canuse=!1)):0==Number(e.unreceivedNum)?(this.failmessage="优惠券已领完",this.receiveFail=!0,!(this.canuse=!1)):e.deadline&&this.isOld(e.deadline)?(this.failmessage="优惠券已过期",this.receiveFail=!0,!(this.canuse=!1)):!(this.canuse=!0)}}},M={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return t.coupons?s("div",{staticClass:"coupon-receive"},[t.isLoading?s("e-loading"):t._e(),t._v(" "),s("div",{staticClass:"coupon-receive-title text-overflow"},[t._v("\n        "+t._s(t.settings.name)+"\n    ")]),t._v(" "),s("div",{staticClass:"coupon-receive-ticket"},[s("div",{staticClass:"ticket-discount"},[s("span",{staticClass:"rate"},[t._v(t._s(parseFloat(t.coupons.rate)))]),t._v(t._s(t._f("couponType")(t.coupons.type))+"\n            "),s("span",[t._v("优惠券")])]),t._v(" "),s("div",{staticClass:"ticket-expire text-overflow"},["day"===t.coupons.deadlineMode?s("span",[null!=t.currentUserCoupon?s("span",[t._v("\n                   优惠券有效至："+t._s(t.receiveTimeExpire(t.currentUserCoupon.deadline))+"\n                ")]):t._e(),t._v(" "),null==t.currentUserCoupon?s("span",[t._v("\n                   领取后"+t._s(t.coupons.fixedDay)+"天内有效\n                ")]):t._e()]):t._e(),t._v(" "),"time"===t.coupons.deadlineMode?s("span",[s("span",{directives:[{name:"show",rawName:"v-show",value:!t.hasReceive,expression:"!hasReceive"}]},[t._v("领券截止日期：")]),t._v(" "),s("span",{directives:[{name:"show",rawName:"v-show",value:t.hasReceive,expression:"hasReceive"}]},[t._v("优惠券有效至：")]),t._v("\n                "+t._s(t.receiveTimeExpire(t.coupons.deadline))+"\n            ")]):t._e()]),t._v(" "),s("div",{staticClass:"ticket-range text-overflow"},[t._v("适用于："+t._s(t.couponType(t.coupons)))])]),t._v(" "),t.hasReceive&&!t.loginMethods?s("div",{staticClass:"receive-status"},[s("img",{staticClass:"status-icon",attrs:{src:"static/images/coupon-yes.png"}}),t._v(" "),s("div",{staticClass:"status-text"},[t._v(t._s(t.successmessage))]),t._v(" "),s("div",{staticClass:"status-user"},[t._v(t._s(t.username)+"账户")]),t._v(" "),s("div",{staticClass:"status__btn",on:{click:function(e){t.useCoupon()}}},[t._v("立即使用")])]):t._e(),t._v(" "),t.receiveFail&&!t.loginMethods?s("div",{staticClass:"receive-status"},[s("img",{staticClass:"status-icon",attrs:{src:"static/images/coupon-no.png"}}),t._v(" "),s("div",{staticClass:"status-text"},[t._v(t._s(t.failmessage))])]):t._e(),t._v(" "),!t.login&&t.canuse?s("fast-login",{on:{lReceiveCoupon:t.lReceiveCoupon}}):t._e()],1):t._e()},staticRenderFns:[]},R=s("VU/8")(S,M,!1,null,null,null).exports,I={name:"pass-receive",mixins:[T.a,w.a],data:function(){return{item:{},message:"",isReceive:!0}},computed:{couponStatus:function(){return o()(this.item).length?"coupon-receive-success":""}},created:function(){var t=this,e=this.$route.params.token;this.$store.state.token?e&&u.a.receiveCoupon({data:{token:e}}).then(function(e){t.item=e,t.message="恭喜您成功领取了一张优惠券！"}).catch(function(e){t.message="优惠券领取失败！",n.a.fail(e.message)}):this.$router.push({name:"login",query:{redirect:this.$route.fullPath}})}},E={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"coupon-receive-page"},[s("div",{class:["coupon-card-bg","clearfix",t.couponStatus]},[s("div",{staticClass:"coupon-info"},[t._v(t._s(t.message))]),t._v(" "),Object.keys(t.item).length?s("div",{staticClass:"e-coupon__body"},[s("div",{staticClass:"e-coupon__header clearfix"},[s("span",{staticClass:"e-coupon__price",domProps:{innerHTML:t._s(t.priceHtml(t.item))}}),t._v(" "),s("div",{staticClass:"e-coupon__name"},[s("div",{staticClass:"text-overflow text-14 coupon-name"},[t._v(t._s(t.item.name))]),t._v(" "),t.item.deadlineMode&&"time"!==t.item.deadlineMode?t._e():s("span",{staticClass:"text-10"},[t._v(t._s(t.timeExpire(t.item.createdTime,t.item.deadline)))]),t._v(" "),"day"!==t.item.deadlineMode||t.item.currentUserCoupon?t._e():s("span",{staticClass:"text-10"},[t._v("领取后"+t._s(t.item.fixedDay)+"天内有效")]),t._v(" "),"day"===t.item.deadlineMode&&t.item.currentUserCoupon?s("span",{staticClass:"text-10"},[t._v(t._s(t.timeExpire(t.item.createdTime,t.item.currentUserCoupon.deadline)))]):t._e()]),t._v(" "),s("span",{staticClass:"coupon-button",on:{click:function(e){t.couponHandle(t.item,t.isReceive)}}},[t._v("去使用")])]),t._v(" "),s("div",{staticClass:"e-coupon__middle"}),t._v(" "),s("div",{staticClass:"e-coupon__bottom text-overflow"},[t._v("\n        可用范围："+t._s(t.scopeFilter(t.item))+"\n      ")])]):t._e()])])},staticRenderFns:[]},$={components:{fastReceive:R,passReceive:s("VU/8")(I,E,!1,null,null,null).exports},data:function(){return{sitePlugins:0,cloudSetting:0}},created:function(){this.getsitePlugins()},computed:c()({},Object(r.mapState)({isLoading:function(e){return e.isLoading}})),methods:{getsitePlugins:function(){var t=this;u.a.sitePlugins({query:{pluginName:"coupon"}}).then(function(e){0<o()(e).length&&(d("2.2.10",e.version)?t.sitePlugins=1:t.sitePlugins=2,t.getsettingsCloud())}).catch(function(e){n.a.fail(e.message)})},getsettingsCloud:function(){var t=this;u.a.settingsCloud().then(function(e){e.sms_enabled?t.cloudSetting=1:t.cloudSetting=2}).catch(function(e){n.a.fail(e.message)})}}},D={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"receive-all"},[e.isLoading?s("e-loading"):e._e(),e._v(" "),1==e.cloudSetting&&1==e.sitePlugins?s("fast-receive"):e._e(),e._v(" "),2==e.cloudSetting||2==e.sitePlugins?s("pass-receive"):e._e()],1)},staticRenderFns:[]},O=s("VU/8")($,D,!1,null,null,null);t.default=O.exports},mypn:function(e,t,s){(function(e,f){!function(s,n){"use strict";if(!s.setImmediate){var i,o,t,a,c=1,r={},u=!1,l=s.document,e=Object.getPrototypeOf&&Object.getPrototypeOf(s);e=e&&e.setTimeout?e:s,i="[object process]"==={}.toString.call(s.process)?function(e){f.nextTick(function(){m(e)})}:function(){if(s.postMessage&&!s.importScripts){var e=!0,t=s.onmessage;return s.onmessage=function(){e=!1},s.postMessage("","*"),s.onmessage=t,e}}()?(a="setImmediate$"+Math.random()+"$",s.addEventListener?s.addEventListener("message",v,!1):s.attachEvent("onmessage",v),function(e){s.postMessage(a+e,"*")}):s.MessageChannel?((t=new MessageChannel).port1.onmessage=function(e){m(e.data)},function(e){t.port2.postMessage(e)}):l&&"onreadystatechange"in l.createElement("script")?(o=l.documentElement,function(e){var t=l.createElement("script");t.onreadystatechange=function(){m(e),t.onreadystatechange=null,o.removeChild(t),t=null},o.appendChild(t)}):function(e){setTimeout(m,0,e)},e.setImmediate=function(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),s=0;s<t.length;s++)t[s]=arguments[s+1];var n={callback:e,args:t};return r[c]=n,i(c),c++},e.clearImmediate=d}function d(e){delete r[e]}function m(e){if(u)setTimeout(m,0,e);else{var t=r[e];if(t){u=!0;try{!function(e){var t=e.callback,s=e.args;switch(s.length){case 0:t();break;case 1:t(s[0]);break;case 2:t(s[0],s[1]);break;case 3:t(s[0],s[1],s[2]);break;default:t.apply(n,s)}}(t)}finally{d(e),u=!1}}}}function v(e){e.source===s&&"string"==typeof e.data&&0===e.data.indexOf(a)&&m(+e.data.slice(a.length))}}("undefined"==typeof self?void 0===e?this:e:self)}).call(t,s("DuR2"),s("W2nU"))}});