webpackJsonp([10],{FVyg:function(e,t,n){"use strict";var r=n("mvHQ"),a=n.n(r),o=n("Gu7T"),s=n.n(o),i=(n("eqfM"),n("/QYm")),c=n("Dd8w"),d=n.n(c),u=n("woOf"),h=n.n(u),f=n("gyMJ"),l={props:{tips:{type:String,default:"拖动左边滑块完成上方拼图"}},data:function(){return{imgInfo:{url:"",jigsaw:"",token:""},dragState:{left:0,width:0,currentX:0,currentLeft:0,btnWidth:0,maskWidth:0},dragToEnd:!1}},created:function(){this.initDragCaptcha()},mounted:function(){var e=this.$refs.bar,t=this.$refs.dragBtn,n=e.getBoundingClientRect();h()(this.dragState,{left:n.left.toFixed(2),width:e.clientWidth,btnWidth:t.offsetWidth/2})},methods:{initDragCaptcha:function(){var e=this;f.a.dragCaptcha().then(function(t){e.imgInfo=d()({},t),h()(e.dragState,{currentLeft:0,maskWidth:0}),e.dragToEnd=!1}).catch(function(e){i.a.fail(e.message)})},handletTouchEnd:function(){var e=this;if(!this.dragToEnd&&this.dragState.currentLeft){var t=this.getToken();this.dragToEnd=!0,f.a.dragValidate({query:{token:t}}).then(function(n){i.a.success("验证成功"),e.$emit("success",t)}).catch(function(t){i.a.fail(t.message),e.initDragCaptcha()})}},handleTouchMove:function(e){if(!this.dragToEnd){e.preventDefault();var t=this.$refs.dragBtn,n=(this.$refs.dragImgBg,this.dragState),r=e.clientX?e.clientX.toFixed(2):e.targetTouches[0].pageX.toFixed(2),a=(r-n.left-n.btnWidth).toFixed(2);a<0&&(a=0),r>n.width&&(a=(n.width-n.left-n.btnWidth).toFixed(2)),h()(this.dragState,{currentLeft:a,maskWidth:(Number(a)+t.offsetWidth/2).toFixed(2)})}},calPositionX:function(){var e=this.$refs.dragImgBg,t=(e.naturalWidth/e.width).toFixed(2);return(Number(this.dragState.currentLeft).toFixed(2)*t).toFixed(2)},getToken:function(){var e={token:this.imgInfo.token,captcha:this.calPositionX()};return[].concat(s()(btoa(a()(e)))).reverse().join("")}}},g={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"e-drag"},[n("div",{staticClass:"e-drag-section"},[n("div",{staticClass:"e-drag-img"},[n("img",{ref:"dragImgBg",attrs:{src:e.imgInfo.url,alt:""}}),e._v(" "),n("img",{staticClass:"e-drag-img__dragable",style:{left:e.dragState.currentLeft+"px"},attrs:{src:e.imgInfo.jigsaw,alt:""}})]),e._v(" "),n("div",{ref:"bar",staticClass:"e-drag-bar"},[n("span",[e._v(e._s(e.tips))]),e._v(" "),n("div",{staticClass:"e-drag-bar__mask",style:{width:e.dragState.maskWidth+"px"}}),e._v(" "),n("div",{ref:"dragBtn",staticClass:"e-drag-btn",style:{left:e.dragState.currentLeft+"px"},on:{touchend:e.handletTouchEnd,touchmove:e.handleTouchMove}},[n("img",{attrs:{src:"static/images/drag.png",alt:""}})])])])])},staticRenderFns:[]},v=n("VU/8")(l,g,!1,null,null,null);t.a=v.exports},GuXH:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});n("XmAh");var r=n("il3B"),a=n("woOf"),o=n.n(a),s=(n("eqfM"),n("/QYm")),i=n("Dd8w"),c=n.n(i),d=n("gyMJ"),u=n("FVyg"),h=n("NYxO"),f=(n("KFVb"),n("SgDA")),l={name:"password-reset",components:{EDrag:u.a},data:function(){return{resetInfo:{account:"",accountType:"",dragCaptchaToken:"",encrypt_password:"",smsCode:"",smsToken:"",type:"register"},dragKey:0,errorMessage:{account:"",encrypt_password:""},validated:{account:!1,encrypt_password:!1},count:{showCount:!1,num:120,codeBtnDisable:!1}}},computed:c()({},Object(h.mapState)({isLoading:function(e){return e.isLoading}}),{btnDisable:function(){return!(this.resetInfo.account&&this.resetInfo.encrypt_password&&this.resetInfo.smsCode||"email"===this.accountType)},accountType:function(){return this.resetInfo.account.includes("@")?"email":"mobile"}}),methods:{validateAccountOrPsw:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"account",t=this.resetInfo[e],n="account"===e?f.a[this.accountType]:f.a[e];if(0==t.length)return this.errorMessage[e]="",!1;this.errorMessage[e]=n.validator(t)?"":n.message},validatedChecker:function(){var e=this.resetInfo.account,t=this.accountType,n=f.a[t];this.validated.account=n.validator(e)},handleSmsSuccess:function(e){this.resetInfo.dragCaptchaToken=e},handleSubmit:function(){var e=this;if(this.$refs.dragComponent.dragToEnd){var t=o()({},this.resetInfo),n=t.encrypt_password,a=t.account,i=window.XXTEA.encryptToBase64(n,window.location.host);if(t.encrypt_password=i,"email"!==this.accountType)d.a.resetPasswordByMobile({query:{mobile:a},data:{smsToken:t.smsToken,smsCode:t.smsCode,encrypt_password:t.encrypt_password}}).then(function(t){r.a.alert({message:"密码重置成功"}).then(function(){e.$router.replace({name:"login",params:{username:a}})})}).catch(function(e){s.a.fail(e.message)});else{var c=this.resetInfo.dragCaptchaToken;d.a.resetPasswordByEmail({query:{email:a},data:{dragCaptchaToken:c}}).then(function(t){r.a.alert({message:"验证链接已发送到 "+a}).then(function(){e.$router.replace({name:"login",params:{username:a}})})}).catch(function(t){switch(t.code){case 4030301:case 4030302:e.dragKey++,e.resetInfo.dragCaptchaToken=""}s.a.fail(t.message)})}}else Object(s.a)("请先完成拼图验证")},clickSmsBtn:function(){this.$refs.dragComponent.dragToEnd?this.handleSendSms():Object(s.a)("请先完成拼图验证")},handleSendSms:function(){var e=this,t=this.resetInfo.account,n=this.resetInfo.dragCaptchaToken;d.a.resetPasswordSMS({query:{mobile:t},data:{dragCaptchaToken:n}}).then(function(t){e.resetInfo.smsToken=t.smsToken,e.countDown()}).catch(function(t){switch(t.code){case 4030301:case 4030302:e.dragKey++,e.resetInfo.dragCaptchaToken="",e.resetInfo.smsToken=""}s.a.fail(t.message)})},countDown:function(){var e=this;this.count.showCount=!0,this.count.codeBtnDisable=!0,this.count.num=120;var t=setInterval(function(){if(e.count.num<=0)return e.count.codeBtnDisable=!1,e.count.showCount=!1,void clearInterval(t);e.count.num--},1e3)}}},g={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"register"},[e.isLoading?n("e-loading"):e._e(),e._v(" "),n("span",{staticClass:"register-title"},[e._v("找回密码")]),e._v(" "),n("e-drag",{key:e.dragKey,ref:"dragComponent",on:{success:e.handleSmsSuccess}}),e._v(" "),n("van-field",{attrs:{placeholder:"请输入手机号或邮箱号","error-message":e.errorMessage.account},on:{blur:function(t){e.validateAccountOrPsw("account")},keyup:function(t){e.validatedChecker()}},model:{value:e.resetInfo.account,callback:function(t){e.$set(e.resetInfo,"account",t)},expression:"resetInfo.account"}}),e._v(" "),n("van-field",{directives:[{name:"show",rawName:"v-show",value:"mobile"===e.accountType,expression:"accountType === 'mobile'"}],attrs:{type:"password",maxLength:"20","error-message":e.errorMessage.encrypt_password,placeholder:"请设置密码（5-20位字符）"},on:{blur:function(t){e.validateAccountOrPsw("encrypt_password")}},model:{value:e.resetInfo.encrypt_password,callback:function(t){e.$set(e.resetInfo,"encrypt_password",t)},expression:"resetInfo.encrypt_password"}}),e._v(" "),n("van-field",{directives:[{name:"show",rawName:"v-show",value:"mobile"===e.accountType,expression:"accountType === 'mobile'"}],attrs:{type:"text",center:"",clearable:"",maxLength:"6",placeholder:"请输入验证码"},model:{value:e.resetInfo.smsCode,callback:function(t){e.$set(e.resetInfo,"smsCode",t)},expression:"resetInfo.smsCode"}},[n("van-button",{attrs:{slot:"button",size:"small",type:"primary",disabled:e.count.codeBtnDisable||!e.validated.account},on:{click:e.clickSmsBtn},slot:"button"},[e._v("\n        发送验证码\n        "),n("span",{directives:[{name:"show",rawName:"v-show",value:e.count.showCount,expression:"count.showCount"}]},[e._v("("+e._s(e.count.num)+")")])])],1),e._v(" "),n("van-button",{staticClass:"primary-btn mb20",attrs:{type:"default",disabled:e.btnDisable},on:{click:e.handleSubmit}},[e._v("确认")])],1)},staticRenderFns:[]},v=n("VU/8")(l,g,!1,null,null,null);t.default=v.exports},KFVb:function(e,t){!function(e){var t,n;void 0===e.btoa&&(e.btoa=(t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),function(e){var n,r=void 0,a=void 0,o=void 0,s=void 0,i=void 0,c=void 0;for(a=o=0,s=e.length,i=(s-=n=s%3)/3<<2,n>0&&(i+=4),r=new Array(i);a<s;)c=e.charCodeAt(a++)<<16|e.charCodeAt(a++)<<8|e.charCodeAt(a++),r[o++]=t[c>>18]+t[c>>12&63]+t[c>>6&63]+t[63&c];return 1==n?(c=e.charCodeAt(a++),r[o++]=t[c>>2]+t[(3&c)<<4]+"=="):2==n&&(c=e.charCodeAt(a++)<<8|e.charCodeAt(a++),r[o++]=t[c>>10]+t[c>>4&63]+t[(15&c)<<2]+"="),r.join("")})),void 0===e.atob&&(e.atob=(n=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1],function(e){var t,r=void 0,a=void 0,o=void 0,s=void 0,i=void 0,c=void 0,d=void 0,u=void 0,h=void 0;if((t=e.length)%4!=0)return"";if(/[^ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789\+\/\=]/.test(e))return"";for(u=t,(d="="==e.charAt(t-2)?1:"="==e.charAt(t-1)?2:0)>0&&(u-=4),u=3*(u>>2)+d,h=new Array(u),i=c=0;i<t&&-1!=(r=n[e.charCodeAt(i++)])&&-1!=(a=n[e.charCodeAt(i++)])&&(h[c++]=String.fromCharCode(r<<2|(48&a)>>4),-1!=(o=n[e.charCodeAt(i++)]))&&(h[c++]=String.fromCharCode((15&a)<<4|(60&o)>>2),-1!=(s=n[e.charCodeAt(i++)]));)h[c++]=String.fromCharCode((3&o)<<6|s);return h.join("")}));var r=2654435769;function a(e,t){var n=e.length,r=n<<2;if(t){var a=e[n-1];if(a<(r-=4)-3||a>r)return null;r=a}for(var o=0;o<n;o++)e[o]=String.fromCharCode(255&e[o],e[o]>>>8&255,e[o]>>>16&255,e[o]>>>24&255);var s=e.join("");return t?s.substring(0,r):s}function o(e,t){var n=e.length,r=n>>2;0!=(3&n)&&++r;var a=void 0;t?(a=new Array(r+1))[r]=n:a=new Array(r);for(var o=0;o<n;++o)a[o>>2]|=e.charCodeAt(o)<<((3&o)<<3);return a}function s(e){return 4294967295&e}function i(e,t,n,r,a,o){return(n>>>5^t<<2)+(t>>>3^n<<4)^(e^t)+(o[3&r^a]^n)}function c(e){return e.length<4&&(e.length=4),e}function d(e){if(/^[\x00-\x7f]*$/.test(e))return e;for(var t=[],n=e.length,r=0,a=0;r<n;++r,++a){var o=e.charCodeAt(r);if(o<128)t[a]=e.charAt(r);else if(o<2048)t[a]=String.fromCharCode(192|o>>6,128|63&o);else{if(!(o<55296||o>57343)){if(r+1<n){var s=e.charCodeAt(r+1);if(o<56320&&s>=56320&&s<=57343){var i=65536+((1023&o)<<10|1023&s);t[a]=String.fromCharCode(240|i>>18&63,128|i>>12&63,128|i>>6&63,128|63&i),++r;continue}}throw new Error("Malformed string")}t[a]=String.fromCharCode(224|o>>12,128|o>>6&63,128|63&o)}}return t.join("")}function u(e,t){return(void 0===t||null===t||t<0)&&(t=e.length),0===t?"":/^[\x00-\x7f]*$/.test(e)||!/^[\x00-\xff]*$/.test(e)?t===e.length?e:e.substr(0,t):t<65535?function(e,t){for(var n=new Array(t),r=0,a=0,o=e.length;r<t&&a<o;r++){var s=e.charCodeAt(a++);switch(s>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:n[r]=s;break;case 12:case 13:if(!(a<o))throw new Error("Unfinished UTF-8 octet sequence");n[r]=(31&s)<<6|63&e.charCodeAt(a++);break;case 14:if(!(a+1<o))throw new Error("Unfinished UTF-8 octet sequence");n[r]=(15&s)<<12|(63&e.charCodeAt(a++))<<6|63&e.charCodeAt(a++);break;case 15:if(!(a+2<o))throw new Error("Unfinished UTF-8 octet sequence");var i=((7&s)<<18|(63&e.charCodeAt(a++))<<12|(63&e.charCodeAt(a++))<<6|63&e.charCodeAt(a++))-65536;if(!(i>=0&&i<=1048575))throw new Error("Character outside valid Unicode range: 0x"+i.toString(16));n[r++]=i>>10&1023|55296,n[r]=1023&i|56320;break;default:throw new Error("Bad UTF-8 encoding 0x"+s.toString(16))}}return r<t&&(n.length=r),String.fromCharCode.apply(String,n)}(e,t):function(e,t){for(var n=[],r=new Array(32768),a=0,o=0,s=e.length;a<t&&o<s;a++){var i=e.charCodeAt(o++);switch(i>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:r[a]=i;break;case 12:case 13:if(!(o<s))throw new Error("Unfinished UTF-8 octet sequence");r[a]=(31&i)<<6|63&e.charCodeAt(o++);break;case 14:if(!(o+1<s))throw new Error("Unfinished UTF-8 octet sequence");r[a]=(15&i)<<12|(63&e.charCodeAt(o++))<<6|63&e.charCodeAt(o++);break;case 15:if(!(o+2<s))throw new Error("Unfinished UTF-8 octet sequence");var c=((7&i)<<18|(63&e.charCodeAt(o++))<<12|(63&e.charCodeAt(o++))<<6|63&e.charCodeAt(o++))-65536;if(!(c>=0&&c<=1048575))throw new Error("Character outside valid Unicode range: 0x"+c.toString(16));r[a++]=c>>10&1023|55296,r[a]=1023&c|56320;break;default:throw new Error("Bad UTF-8 encoding 0x"+i.toString(16))}if(a>=32766){var d=a+1;r.length=d,n[n.length]=String.fromCharCode.apply(String,r),t-=d,a=-1}}return a>0&&(r.length=a,n[n.length]=String.fromCharCode.apply(String,r)),n.join("")}(e,t)}function h(e,t){return void 0===e||null===e||0===e.length?e:(e=d(e),t=d(t),a(function(e,t){var n=e.length,a=n-1,o=void 0,c=void 0,d=void 0,u=void 0,h=void 0,f=void 0;for(c=e[a],d=0,f=0|Math.floor(6+52/n);f>0;--f){for(u=(d=s(d+r))>>>2&3,h=0;h<a;++h)o=e[h+1],c=e[h]=s(e[h]+i(d,o,c,h,u,t));o=e[0],c=e[a]=s(e[a]+i(d,o,c,a,u,t))}return e}(o(e,!0),c(o(t,!1))),!1))}function f(e,t){return void 0===e||null===e||0===e.length?e:(t=d(t),u(a(function(e,t){var n=e.length,a=n-1,o=void 0,c=void 0,d=void 0,u=void 0,h=void 0;for(o=e[0],d=s(Math.floor(6+52/n)*r);0!==d;d=s(d-r)){for(u=d>>>2&3,h=a;h>0;--h)c=e[h-1],o=e[h]=s(e[h]-i(d,o,c,h,u,t));c=e[a],o=e[0]=s(e[0]-i(d,o,c,0,u,t))}return e}(o(e,!1),c(o(t,!1))),!0)))}e.XXTEA={utf8Encode:d,utf8Decode:u,encrypt:h,encryptToBase64:function(t,n){return e.btoa(h(t,n))},decrypt:f,decryptFromBase64:function(t,n){return void 0===t||null===t||0===t.length?t:f(e.atob(t),n)}}}(window)}});