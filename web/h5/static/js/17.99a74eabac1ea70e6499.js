webpackJsonp([17],{"L/LV":function(e,n,t){"use strict";var i=t("SgDA");n.a={methods:{validateMobileOrPsw:function(e){var n=0<arguments.length&&void 0!==e?e:"mobile",t=this.userinfo[n],s=i.a[n];0===t.length&&(this.errorMessage[n]=""),this.errorMessage[n]=s.validator(t)?"":s.message},validatedChecker:function(){11<this.userinfo.mobile.length&&(this.userinfo.mobile=this.userinfo.mobile.substring(0,11));var e=this.userinfo.mobile,n=i.a.mobile;this.validated.mobile=n.validator(e)}}}},rmiZ:function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var s=t("Dd8w"),i=t.n(s),a=t("Xxa5"),o=t.n(a),r=(t("eqfM"),t("/QYm")),c=t("exGp"),l=t.n(c),u=t("FVyg"),m=(t("SgDA"),t("KFVb"),t("gyMJ")),d=t("NyOD"),g=t("1JqO"),h=t("L/LV"),f=t("NYxO"),v={name:"fast-login",mixins:[d.a,g.a,h.a],components:{EDrag:u.a},data:function(){return{userinfo:{mobile:"",dragCaptchaToken:void 0,smsCode:"",smsToken:"",type:"sms_login"},userTerms:!1,privacyPolicy:!1,registerSettings:null,agreement:!0,dragEnable:!1,dragKey:0,errorMessage:{mobile:""},validated:{mobile:!1},count:{showCount:!1,num:60,codeBtnDisable:!1}}},computed:{btnDisable:function(){return!(this.userinfo.mobile&&this.userinfo.smsCode&&this.agreement)}},created:function(){var n=this;return l()(o.a.mark(function e(){return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n.$store.state.token)return r.a.loading({message:"请稍后"}),n.afterLogin(),e.abrupt("return");e.next=4;break;case 4:n.getPrivacySetting();case 5:case"end":return e.stop()}},e,n)}))()},methods:i()({},Object(f.mapActions)(["addUser","setMobile","sendSmsSend","fastLogin"]),{getPrivacySetting:function(){var n=this;return l()(o.a.mark(function e(){return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m.a.getSettings({query:{type:"user"}}).then(function(e){e.auth.user_terms_enabled&&(n.userTerms=!0),e.auth.privacy_policy_enabled&&(n.privacyPolicy=!0)}).catch(function(e){r.a.fail(e.message)});case 2:n.registerSettings=e.sent;case 3:case"end":return e.stop()}},e,n)}))()},lookPrivacyPolicy:function(){window.location.href=window.location.origin+"/mapi_v2/School/getPrivacyPolicy"},handleSmsSuccess:function(e){this.userinfo.dragCaptchaToken=e,this.handleSendSms()},handleSubmit:function(){var n=this;this.fastLogin({mobile:this.userinfo.mobile,smsToken:this.userinfo.smsToken,smsCode:this.userinfo.smsCode,loginType:"sms",client:"h5"}).then(function(e){n.afterLogin()}).catch(function(e){r.a.fail(e.message)})},clickSmsBtn:function(){this.dragEnable?this.$refs.dragComponent.dragToEnd?this.$refs.dragComponent.initDragCaptcha():Object(r.a)("请先完成拼图验证"):this.handleSendSms()},handleSendSms:function(){var n=this;this.sendSmsSend(this.userinfo).then(function(e){n.userinfo.smsToken=e.smsToken,n.countDown(),n.dragEnable=!1,n.userinfo.dragCaptchaToken=""}).catch(function(e){switch(e.code){case 4030301:case 4030302:n.dragKey++,n.userinfo.dragCaptchaToken="",n.userinfo.smsToken="",r.a.fail(e.message);break;case 4030303:n.dragEnable?r.a.fail(e.message):n.dragEnable=!0;break;default:r.a.fail(e.message)}})},countDown:function(){var n=this;this.$nextTick(function(e){n.$refs.smsCode.$refs.input.focus()}),this.count.showCount=!0,this.count.codeBtnDisable=!0,this.count.num=60;var e=setInterval(function(){if(n.count.num<=0)return n.count.codeBtnDisable=!1,n.count.showCount=!1,void clearInterval(e);n.count.num--},1e3)},checkAgree:function(){this.agreement=!this.agreement},changeLogin:function(){this.$router.push({name:"login"})}})},b={render:function(){var n=this,e=n.$createElement,t=n._self._c||e;return t("div",{staticClass:"login"},[t("span",{staticClass:"login-title"},[n._v("手机快捷登录")]),n._v(" "),t("span",{staticClass:"login-des"},[n._v("新用户将为您自动注册")]),n._v(" "),t("van-field",{staticClass:"login-input e-input",attrs:{placeholder:"请输入手机号",maxLength:"11",type:"number",border:!1,clearable:"","error-message":n.errorMessage.mobile},on:{blur:function(e){n.validateMobileOrPsw("mobile")},keyup:function(e){n.validatedChecker()}},model:{value:n.userinfo.mobile,callback:function(e){n.$set(n.userinfo,"mobile",e)},expression:"userinfo.mobile"}}),n._v(" "),n.dragEnable?t("e-drag",{key:n.dragKey,ref:"dragComponent",attrs:{limitType:"sms_login"},on:{success:n.handleSmsSuccess}}):n._e(),n._v(" "),t("van-field",{ref:"smsCode",staticClass:"login-input e-input",attrs:{type:"number",border:!1,center:"",clearable:"",maxLength:"6",placeholder:"请输入验证码"},model:{value:n.userinfo.smsCode,callback:function(e){n.$set(n.userinfo,"smsCode",e)},expression:"userinfo.smsCode"}},[t("van-button",{attrs:{slot:"button",size:"small",type:"primary",disabled:n.count.codeBtnDisable||!n.validated.mobile},on:{click:n.clickSmsBtn},slot:"button"},[n._v("\n        发送验证码\n        "),t("span",{directives:[{name:"show",rawName:"v-show",value:n.count.showCount,expression:"count.showCount"}]},[n._v("("+n._s(n.count.num)+")")])])],1),n._v(" "),t("van-button",{staticClass:"primary-btn mb20",attrs:{type:"default",disabled:n.btnDisable},on:{click:n.handleSubmit}},[n._v("登录")]),n._v(" "),t("div",{staticClass:"login-bottom text-center"},[n.userTerms||n.privacyPolicy?t("div",{staticClass:"login-agree"},[t("van-checkbox",{attrs:{"checked-color":"#408ffb","icon-size":16},on:{click:n.checkAgree},model:{value:n.agreement,callback:function(e){n.agreement=e},expression:"agreement"}}),n._v("\n             我已阅读并同意"),n.userTerms?t("i",{on:{click:n.lookPrivacyPolicy}},[n._v("《用户服务》")]):n._e(),n.userTerms&&n.privacyPolicy?t("span",[n._v("和")]):n._e(),n.privacyPolicy?t("span",[n._v("《"),t("i",{on:{click:n.lookPrivacyPolicy}},[n._v("隐私协议")]),n._v("》")]):n._e()],1):n._e(),n._v(" "),t("div",{staticClass:"login-change",on:{click:n.changeLogin}},[t("img",{staticClass:"login_change-icon",attrs:{src:"static/images/login_change.png"}}),n._v("切换账号密码登录\n        ")])])],1)},staticRenderFns:[]},p=t("VU/8")(v,b,!1,null,null,null);n.default=p.exports}});