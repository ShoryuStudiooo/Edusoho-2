webpackJsonp([4],{NDEt:function(t,a,e){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var i=e("Xxa5"),s=e.n(i),n=e("woOf"),r=e.n(n),c=(e("eqfM"),e("/QYm")),o=e("exGp"),l=e.n(o),d=e("Dd8w"),u=e.n(d),p=e("gyMJ"),y=(e("mtWM"),e("NYxO")),h={data:function(){return{detail:{},payWay:"",selected:!0,paySettings:{},inWechat:this.isWeixinBrowser(),targetType:this.$route.query.targetType,timeoutId:-1}},computed:u()({},Object(y.mapState)(["wechatSwitch","isLoading"]),{validPayWay:function(){return this.paySettings.wxpayEnabled||this.paySettings.alipayEnabled&&!this.inWechat}}),created:function(){var t=this;return l()(s.a.mark(function a(){var e,i,n,o,l;return s.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,p.a.getSettings({query:{type:"payment"}}).catch(function(t){c.a.fail(t.message)});case 2:t.paySettings=a.sent,t.paySettings.alipayEnabled&&!t.inWechat?t.payWay="Alipay_LegacyH5":t.paySettings.wxpayEnabled&&(t.payWay="WechatPay_H5"),e=t.$route.query,i=e.source,n=e.id,o=e.sn,l=e.targetId,"order"!==i?p.a.createOrder({data:{targetType:t.targetType,targetId:n,isOrderCreate:1,couponCode:t.$route.params.couponCode,unit:t.$route.params.unit,num:t.$route.params.num}}).then(function(a){t.detail=r()({},a)}).catch(function(t){c.a.fail(t.message)}):p.a.getOrderDetail({query:{sn:o}}).then(function(a){if("success"===a.status&&l){if(t.wechatSwitch)return void t.$router.replace({path:"/pay_success",query:{targetType:t.targetType,targetId:l}});t.$router.push({path:"/"+t.targetType+"/"+l})}t.detail=r()({},a)}).catch(function(t){c.a.fail(t.message)});case 6:case"end":return a.stop()}},a,t)}))()},beforeRouteLeave:function(t,a,e){clearTimeout(this.timeoutId),e()},methods:{handlePay:function(){var t=this;this.validPayWay&&("WechatPay_H5"===this.payWay&&this.inWechat?window.location.href=window.location.origin+"/pay/center/wxpay_h5?pay_amount="+this.detail.pay_amount+"&title="+this.detail.title+"&sn="+this.detail.sn:p.a.createTrade({data:{gateway:this.payWay,type:"purchase",orderSn:this.detail.sn,app_pay:"Y"}}).then(function(a){"WechatPay_H5"!==t.payWay?window.location.href=a.payUrl:t.getTradeInfo(a.tradeSn).then(function(){window.location.href=a.mwebUrl})}).catch(function(t){c.a.fail(t.message)}))},isWeixinBrowser:function(){return/micromessenger/.test(navigator.userAgent.toLowerCase())},getTradeInfo:function(t){var a=this;return p.a.getTrade({query:{tradesSn:t}}).then(function(e){if(e.isPaid)return a.wechatSwitch?void a.$router.replace({path:"/pay_success",query:{paidUrl:window.location.origin+e.paidSuccessUrlH5}}):void(window.location.href=window.location.origin+e.paidSuccessUrlH5);a.timeoutId=setTimeout(function(){a.getTradeInfo(t)},2e3)}).catch(function(t){c.a.fail(t.message)})}}},_={render:function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"payPage"},[t.isLoading?e("e-loading"):t._e(),t._v(" "),e("div",{staticClass:"payPage__order"},[e("div",{staticClass:"order__head"},[t._v("\n      支付方式\n    ")]),t._v(" "),e("div",{staticClass:"order__infomation"},[e("div",{staticClass:"title"},[t._v(t._s(t.detail.title))]),t._v(" "),e("div",{staticClass:"sum"},[e("span",[t._v("待支付")]),t._v(" "),e("span",{staticClass:"sum__price"},[t._v("¥ "),e("span",{staticClass:"num"},[t._v(t._s(t._f("toMoney")(t.detail.pay_amount)))])])]),t._v(" "),e("div",{staticClass:"payWay"},[e("div",{directives:[{name:"show",rawName:"v-show",value:t.paySettings.alipayEnabled&&!t.inWechat,expression:"paySettings.alipayEnabled && !inWechat"}],class:["payWay__item",{"payWay__item--selected":"Alipay_LegacyH5"===t.payWay}],on:{click:function(a){t.payWay="Alipay_LegacyH5",t.selected=!0}}},[e("img",{staticClass:"correct",attrs:{src:"static/images/correct.png"}}),t._v(" "),e("div",{staticClass:"right"}),t._v(" "),e("img",{attrs:{src:"static/images/zfb.png"}})]),t._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:t.paySettings.wxpayEnabled,expression:"paySettings.wxpayEnabled"}],class:["payWay__item",{"payWay__item--selected":"WechatPay_H5"===t.payWay}],on:{click:function(a){t.payWay="WechatPay_H5",t.selected=!1}}},[e("img",{staticClass:"correct",attrs:{src:"static/images/correct.png"}}),t._v(" "),e("div",{staticClass:"right"}),t._v(" "),e("img",{attrs:{src:"static/images/wx.png"}})])])])]),t._v(" "),e("div",{class:["payPage__payBtn",{disabled:!t.validPayWay}],on:{click:t.handlePay}},[t._v("\n    "+t._s(t.validPayWay?"立即支付":"无可用支付方式")+"\n  ")])],1)},staticRenderFns:[]},g=e("VU/8")(h,_,!1,null,null,null);a.default=g.exports},q3mx:function(t,a,e){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var i=e("Dd8w"),s=e.n(i),n=(e("gyMJ"),e("NYxO")),r={data:function(){return{targetId:this.$route.query.targetId||"",targetType:this.$route.query.targetType||"",paidUrl:this.$route.query.paidUrl}},computed:s()({},Object(n.mapState)(["wechatSwitch","wechatSettings"])),created:function(){this.wechatSwitch||this.$router.replace({path:"/"})},methods:{backToCourse:function(){this.paidUrl?window.location.href=this.paidUrl:this.$router.replace({path:"/"+this.targetType+"/"+this.targetId})}}},c={render:function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"pay-success-container"},[t._m(0),t._v(" "),t.wechatSettings?e("div",{staticClass:"qrcode-img-container"},[e("img",{attrs:{src:t.wechatSettings.official_qrcode,alt:""}})]):t._e(),t._v(" "),t._m(1),t._v(" "),e("van-button",{staticClass:"btn-back-course",attrs:{type:"primary"},on:{click:t.backToCourse}},[t._v("返回课程")])],1)},staticRenderFns:[function(){var t=this.$createElement,a=this._self._c||t;return a("div",{staticClass:"pay-success-text"},[a("i",{staticClass:"h5-icon h5-icon-check"}),this._v(" "),a("span",{staticClass:"text-18 success-text"},[this._v("支付成功！")]),this._v(" "),a("div",{staticClass:"mt5 text-14 color-red"},[this._v("为享受更好的教学服务，建议您开启课程通知。")])])},function(){var t=this.$createElement,a=this._self._c||t;return a("div",{staticClass:"press-img-container"},[a("img",{attrs:{src:"static/images/wechat_press.png",alt:""}}),this._v(" "),a("div",{staticClass:"press-text text-14"},[this._v("请长按二维码开启课程通知")])])}]},o=e("VU/8")(r,c,!1,null,null,null);a.default=o.exports}});