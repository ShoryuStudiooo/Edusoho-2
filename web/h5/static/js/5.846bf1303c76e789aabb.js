webpackJsonp([5],{"13mi":function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=o("Dd8w"),n=o.n(r),a=o("Xxa5"),i=o.n(a),c=(o("eqfM"),o("/QYm")),s=o("exGp"),l=o.n(s),u=o("NyOD"),d=o("1JqO"),p=o("Du/2"),h=o("gyMJ"),v=o("NYxO"),f={mixins:[u.a,d.a],name:"social-wx",created:function(){var e=this;return l()(i.a.mark(function t(){var o,r;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.$store.state.token){t.next=9;break}if(1!=localStorage.getItem("first_direct")){t.next=5;break}return e.$router.replace({path:e.$route.query.redirect||"/"}),t.abrupt("return");case 5:return c.a.loading({message:"请稍后"}),e.afterLogin(),localStorage.setItem("first_direct",1),t.abrupt("return");case 9:if(o=localStorage.getItem("socialBinded_wx")?JSON.parse(localStorage.getItem("socialBinded_wx")):e.socialBinded.wx,e.setSocialStatus({key:"wx",status:o}),r=location.search.match(/\?code.*&/g)){t.next=16;break}return localStorage.setItem("first_direct",0),e.wxLogin(),t.abrupt("return");case 16:return c.a.loading({message:"正在登录"}),r=r[0].slice(6,-1),t.next=20,h.a.login({params:{code:r,type:"weixinmob"}}).then(function(t){e.userLogin(t),c.a.clear(),c.a.success({duration:2e3,message:"登录成功"});var o=e.socialBinded.wx?-2:-7;e.$route.query.callbackType&&(o+=1),localStorage.setItem("socialBinded_wx",!0),e.$router.go(o)}).catch(function(e){localStorage.setItem("socialBinded_wx",!1),window.location.href="/login/bind/weixinmob?os=h5&_target_path="+encodeURIComponent(location.pathname+location.hash)});case 20:case"end":return t.stop()}},t,e)}))()},computed:n()({},Object(v.mapState)(["socialBinded"])),methods:n()({},Object(v.mapMutations)({setSocialStatus:p.j,userLogin:p.o}),{wxLogin:function(){c.a.loading({message:"请稍后"});var e=encodeURIComponent(location.origin+location.pathname+location.hash);window.location.href="https://open.weixin.qq.com/connect/oauth2/authorize?appid="+this.$route.query.weixinmob_key+"&redirect_uri="+e+"&response_type=code&scope=snsapi_base&state=123&connect_redirect=1#wechat_redirect"}})},m={render:function(){var e=this.$createElement;return(this._self._c||e)("div")},staticRenderFns:[]},g=o("VU/8")(f,m,!1,null,null,null);t.default=g.exports},uoNF:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=o("gyMJ"),n={data:function(){return{code:"",popupShow:!1,closeOnClickOverlay:!1,btnDisable:!0,isErrorCode:!1,errorText:"",courseId:"",courseTitle:""}},watch:{code:function(e,t){var o=e.length-t.length;if(Math.abs(o)>8){var r=this.spliceCode(e);this.code=r||e,this.isErrorCode=!1,this.btnDisable=!1,this.errorText=""}}},methods:{spliceCode:function(e){var t=/[a-z0-9A-Z]{8}/;return!!e.match(t)&&e.match(t)[0]},checkCodeChange:function(e){if(e.length>7){return/^[a-z0-9A-Z]{8}$/.test(e)?(this.isErrorCode=!1,this.btnDisable=!1,void(this.errorText="")):(this.isErrorCode=!0,void(this.errorText="8位数字、英文字母组成"))}this.isErrorCode=!1,this.btnDisable=!0,this.errorText=""},codeCovert:function(e){var t=this;r.a.couponCheck({query:{code:e}}).then(function(o){if(console.log(o,"couponCheck res"),!1===o.success||o.error)return t.isErrorCode=!0,void(t.errorText=o.error.message);r.a.exchangeCoupon({query:{code:e}}).then(function(e){console.log("exchangeCoupon",e),t.courseId=e.products[0].course.id,t.courseTitle=e.products[0].course.displayedTitle,t.popupShow=!0}).catch(function(e){t.isErrorCode=!0,t.errorText=e.message})})},toStudy:function(){var e=this.courseId;if(e){var t=encodeURIComponent("/my/orders");this.$router.push({path:"/course/"+e+"?backUrl="+t})}}}},a={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"coupon-covert-container"},[o("h2",{staticClass:"title"},[e._v("兑换卡券")]),e._v(" "),o("van-field",{class:[{"error-code":e.isErrorCode},"e-input","coupon-input"],attrs:{placeholder:"请输入8位兑换码",clearable:""},on:{input:function(t){e.checkCodeChange(e.code)}},model:{value:e.code,callback:function(t){e.code="string"==typeof t?t.trim():t},expression:"code"}}),e._v(" "),e.isErrorCode?o("span",{staticClass:"error-code text-14"},[e._v(e._s(e.errorText))]):e._e(),e._v(" "),o("van-button",{staticClass:"covert-submit",attrs:{type:"info",disabled:e.btnDisable||e.isErrorCode},on:{click:function(t){e.codeCovert(e.code)}}},[e._v("确认")]),e._v(" "),o("van-popup",{staticClass:"coupon-covert-popup",attrs:{closeOnClickOverlay:e.closeOnClickOverlay},model:{value:e.popupShow,callback:function(t){e.popupShow=t},expression:"popupShow"}},[o("div",{staticClass:"modal-content"},[e._v("\n      兑换成功"),o("div",[e._v("恭喜您获得"+e._s(e.courseTitle)+"课程")])]),e._v(" "),o("div",{staticClass:"color-primary mt10 text-15",on:{click:e.toStudy}},[e._v("去学习")])])],1)},staticRenderFns:[]},i=o("VU/8")(n,a,!1,null,null,null);t.default=i.exports}});